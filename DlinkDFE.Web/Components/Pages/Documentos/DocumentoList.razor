@page "/documentos"

@inherits DocumentoListBase

<MudContainer Class="pt-8" Width="100%">

    <FilterPanel 
        _searchString="_searchString"
        _selectedStatuses="_selectedStatuses"
        _selectedModels="_selectedModels"
        _statusOptions="_statusOptions"
        _modelOptions="_modelOptions"
        ApplyFilters="ApplyFilters"
        IntValue="IntValue" />

    <MudStack Row="true">
        <MudItem>
            <MudButton OnClick="OnExpandCollapseClick">
                @(_expanded ? "Menos Filtros" : "Mais Filtros")
            </MudButton>

            <MudCollapse Expanded="_expanded">
                <FilterColapse 
                    Expanded="_expanded"
                    OnExpandCollapseClick="OnExpandCollapseClick"
                    _selectedStatuses="_selectedStatuses"
                    _statusOptions="_statusOptions"
                    _selectedModels="_selectedModels"
                    _modelOptions="_modelOptions"
                    IntValue="IntValue"
                    ApplyFilters="ApplyFilters" />
            </MudCollapse>

        </MudItem>
    </MudStack>

    <MudDataGrid Class="pa-2"
                 T="Documento" 
                 Items="@FilteredDocumentos" 
                 MultiSelection="true" 
                 Filterable="true" 
                 SortMode="SortMode.Multiple">
        <Columns>
            <SelectColumn T="Documento" />
            <PropertyColumn Property="x => x.Status" Title="Status" />
            <PropertyColumn Property="x => x.Modelo" Title="Modelo" />
            <PropertyColumn Property="x => x.Numero" Title="Número" />
            <PropertyColumn Property="x => x.Serie" Title="Série" />
            <PropertyColumn Property="x => x.Emissao" Title="Emissão" />
            <PropertyColumn Property="x => x.Destinatario" Title="Destinatário" />
            <PropertyColumn Property="x => x.Valor" Title="Valor" />
            <TemplateColumn Title="Ações" Icon="@Icons.Material.Filled.MoreVert">
                <CellTemplate>
                    <MudMenu  
                        Icon="@Icons.Material.Filled.MoreVert"
                        ActivationEvent="@MouseEvent.MouseOver" 
                        AnchorOrigin="Origin.BottomCenter" 
                        TransformOrigin="Origin.TopCenter">
                        <ChildContent>
                            <MudMenuItem Icon="@Icons.Material.Filled.Print">Imprimir</MudMenuItem>
                            <MudMenuItem Icon="@Icons.Material.Filled.Archive">Arquivo XML</MudMenuItem>
                            <MudMenuItem Icon="@Icons.Material.Filled.Send">Enviar</MudMenuItem>
                            <MudMenuItem OnClick="ShowCancelConfirmation" Icon="@Icons.Material.Filled.DeleteForever">Cancelar</MudMenuItem>
                        </ChildContent>
                    </MudMenu>
                </CellTemplate>
            </TemplateColumn>
        </Columns>
        <PagerContent>
            <MudDataGridPager T="Documento" />
        </PagerContent>
    </MudDataGrid>
</MudContainer>

<MudMessageBox @ref="_mudMessageBox" Title="Atenção" CancelText="Desistir">
    <MessageContent>
        Tem certeza que deseja cancelar este documento? Esta ação não poderá ser desfeita.
    </MessageContent>
    <YesButton>
        <MudButton Variant="Variant.Filled" Color="Color.Error" StartIcon="@Icons.Material.Filled.DeleteForever">Cancelar!</MudButton>
    </YesButton>
</MudMessageBox>

@code {
    public bool _expanded = false;
    public int IntValue { get; set; }
    public string SelectedValue { get; set; }

    private void OnExpandCollapseClick() {
        _expanded = !_expanded;
    }

    private void Reset() {
        SelectedValue = null;
    }
}
