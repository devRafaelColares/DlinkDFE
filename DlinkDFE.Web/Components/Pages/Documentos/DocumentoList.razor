@page "/documentos"

@inherits DocumentoListBase

<MudContainer Class="pt-8" Width="100%">

    <MudStack Row="true">
        <MudGrid>
            <MudItem xs="8">
                <MudTextField 
                    Style="width: 330px;"
                    @bind-Value="_searchString" 
                    Placeholder="Pesquisar..." 
                    Adornment="Adornment.Start"
                    AdornmentIcon="@Icons.Material.Filled.Search" 
                    Class="mt-0"
                    Immediate="true"
                    OnInput="@((ChangeEventArgs e) => {
                        if (e.Value != null)
                        {
                            _searchString = e.Value.ToString();
                            ApplyFilters();
                        }
                    })">
                </MudTextField>
            </MudItem>

            <MudItem xs="4">
                <MudSelect T="string"
                           Placeholder="Status"
                           Variant="Variant.Outlined"
                           MultiSelection="true"
                           SelectedValues="@_selectedStatuses"
                           SelectedValuesChanged="@(values => {
                               _selectedStatuses = new HashSet<string>(values);
                               ApplyFilters();
                           })"
                           MultiSelectionTextFunc="@(selectedItems => "Status")"
                           CloseMenuOnItemClick="false"
                           Class="mt-0">
                    @foreach (var status in _statusOptions)
                    {
                        <MudSelectItem T="string" Value="@status">@status</MudSelectItem>
                    }
                </MudSelect>
            </MudItem>
            
            <MudItem xs="4">
<MudSelect T="string"
           Placeholder="Modelo"
           Variant="Variant.Outlined"
           Class="mt-0"
            MultiSelection="true"

           SelectedValues="@_selectedModels"
           SelectedValuesChanged="@(values => {
               _selectedModels = new HashSet<string>(values);
               ApplyFilters();
           })">
    @foreach (var model in _modelOptions)
    {
        <MudSelectItem T="string" Value="@model">@model</MudSelectItem>
    }
</MudSelect>

            </MudItem>
        </MudGrid>
    </MudStack>

    <MudDataGrid Class="pa-2"
                 T="Documento" 
                 Items="@FilteredDocumentos" 
                 MultiSelection="true" 
                 Filterable="true" 
                 SortMode="SortMode.Multiple">
        
        <Columns>
            <SelectColumn T="Documento" />
            <PropertyColumn Property="x => x.Status" Title="Status" />
            <PropertyColumn Property="x => x.Modelo" Title="Modelo" />
            <PropertyColumn Property="x => x.Numero" Title="Número" />
            <PropertyColumn Property="x => x.Serie" Title="Série" />
            <PropertyColumn Property="x => x.Emissao" Title="Emissão" />
            <PropertyColumn Property="x => x.Destinatario" Title="Destinatário" />
            <PropertyColumn Property="x => x.Valor" Title="Valor" />

            <TemplateColumn Title="Ações" Icon="@Icons.Material.Filled.MoreVert">
                <CellTemplate>
                    <MudMenu  
                        Icon="@Icons.Material.Filled.MoreVert"
                        ActivationEvent="@MouseEvent.MouseOver" 
                        AnchorOrigin="Origin.BottomCenter" 
                        TransformOrigin="Origin.TopCenter">
                        <ChildContent>
                            <MudMenuItem Icon="@Icons.Material.Filled.Print">Imprimir</MudMenuItem>
                            <MudMenuItem Icon="@Icons.Material.Filled.Archive">Arquivo XML</MudMenuItem>
                            <MudMenuItem Icon="@Icons.Material.Filled.Send">Enviar</MudMenuItem>
                            <MudMenuItem OnClick="ShowCancelConfirmation" Icon="@Icons.Material.Filled.DeleteForever">Cancelar</MudMenuItem>
                        </ChildContent>
                    </MudMenu>
                </CellTemplate>
            </TemplateColumn>
        </Columns>
        <PagerContent>
            <MudDataGridPager T="Documento" />
        </PagerContent>
    </MudDataGrid>
</MudContainer>

<MudMessageBox @ref="_mudMessageBox" Title="Atenção" CancelText="Desistir">
    <MessageContent>
        Tem certeza que deseja cancelar este documento? Esta ação não poderá ser desfeita.
    </MessageContent>
    <YesButton>
        <MudButton Variant="Variant.Filled" Color="Color.Error" StartIcon="@Icons.Material.Filled.DeleteForever">Cancelar!</MudButton>
    </YesButton>
</MudMessageBox>
